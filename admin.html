<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MindMirror Admin Panel</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: Arial, sans-serif; background:#f0f2f5; }
    .sidebar {
      width: 240px; background: #1e2a38; color: white;
      position: fixed; top:0; left:0; bottom:0;
      display: flex; flex-direction: column;
    }
    .sidebar .logo {
      font-weight: bold; padding:20px; text-align:center; background:#18202b;
    }
    .sidebar nav a {
      padding:15px 20px; color:white; text-decoration:none; display:block;
    }
    .sidebar nav a:hover { background:rgba(255,255,255,0.1); }
    .main {
      margin-left:240px; padding:20px;
    }
    .button {
      background:#4a90e2; color:white; border:none; padding:10px 15px;
      margin:5px; cursor:pointer; border-radius:5px;
    }
    table { width:100%; border-collapse: collapse; margin-top:20px; }
    th,td { border:1px solid #ccc; padding:10px; }
    th { background:#eee; }
    .hidden { display:none; }
    input[type="text"] { width: 100%; padding: 5px; margin:5px 0; }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="logo">MindMirror Admin</div>
    <nav>
      <a href="#" onclick="loadQuestionManager()">Questions</a>
      <a href="#">Dashboard</a>
      <a href="#">Reports</a>
      <a href="#">Users</a>
      <a href="#">Preview Test</a>
    </nav>
  </div>
  <div class="main" id="main-content">
    <h2>Welcome, Admin</h2>
    <p>Select an option from the sidebar to get started.</p>
  </div>
  <script>
    function loadQuestionManager(){
      const content = document.getElementById("main-content");
      content.innerHTML = `
        <h2>Question Manager</h2>
        <button class="button" onclick="showAddForm()">Add Question</button>
        <button class="button" onclick="deleteSelected()">Delete Selected</button>
        <table id="questions-table">
          <thead>
            <tr>
              <th><input type="checkbox" id="select-all" onchange="toggleSelectAll(this)"></th>
              <th>Question</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="question-form" class="hidden">
          <h3 id="form-title">Add Question</h3>
          <input type="hidden" id="qid" />
          <label>Question:</label>
          <input type="text" id="qtext" />
          <div>
            <label>Options:</label>
            <input type="text" id="opt1" value="Strongly Agree" />
            <input type="text" id="opt2" value="Agree" />
            <input type="text" id="opt3" value="Neutral" />
            <input type="text" id="opt4" value="Disagree" />
            <input type="text" id="opt5" value="Strongly Disagree" />
          </div>
          <button class="button" onclick="saveQuestion()">Save</button>
          <button class="button" onclick="hideForm()">Cancel</button>
        </div>
      `;
      loadQuestions();
    }

    async function loadQuestions(){
      const res = await fetch('/api/questions');
      const data = await res.json();
      const tbody = document.querySelector("#questions-table tbody");
      tbody.innerHTML = data.map(q=>`
        <tr>
          <td><input type="checkbox" class="select-q" value="${q.id}"></td>
          <td>${q.text}</td>
          <td><button onclick="editQuestion('${q.id}')">Edit</button></td>
        </tr>
      `).join("");
    }

    function toggleSelectAll(master){
      document.querySelectorAll(".select-q").forEach(cb => cb.checked = master.checked);
    }

    function showAddForm(){
      document.getElementById("question-form").classList.remove("hidden");
      document.getElementById("form-title").innerText = "Add Question";
      document.getElementById("qid").value = "";
      document.getElementById("qtext").value = "";
      document.getElementById("opt1").value = "Strongly Agree";
      document.getElementById("opt2").value = "Agree";
      document.getElementById("opt3").value = "Neutral";
      document.getElementById("opt4").value = "Disagree";
      document.getElementById("opt5").value = "Strongly Disagree";
    }

    function hideForm(){
      document.getElementById("question-form").classList.add("hidden");
    }

    async function saveQuestion(){
      const id = document.getElementById("qid").value;
      const text = document.getElementById("qtext").value;
      const options = [
        document.getElementById("opt1").value,
        document.getElementById("opt2").value,
        document.getElementById("opt3").value,
        document.getElementById("opt4").value,
        document.getElementById("opt5").value
      ];
      if(id){
        await fetch('/api/questions/update', {
          method:"POST",headers:{"Content-Type":"application/json"},
          body:JSON.stringify({id,text,options})
        });
      } else {
        await fetch('/api/questions/add', {
          method:"POST",headers:{"Content-Type":"application/json"},
          body:JSON.stringify({text,options})
        });
      }
      hideForm();
      loadQuestions();
    }

    async function editQuestion(id){
      const res = await fetch('/api/questions');
      const data = await res.json();
      const q = data.find(x=>x.id===id);
      if(q){
        document.getElementById("qid").value = q.id;
        document.getElementById("qtext").value = q.text;
        document.getElementById("opt1").value = q.options[0]||"";
        document.getElementById("opt2").value = q.options[1]||"";
        document.getElementById("opt3").value = q.options[2]||"";
        document.getElementById("opt4").value = q.options[3]||"";
        document.getElementById("opt5").value = q.options[4]||"";
        document.getElementById("form-title").innerText = "Edit Question";
        document.getElementById("question-form").classList.remove("hidden");
      }
    }

    async function deleteSelected(){
      const ids = Array.from(document.querySelectorAll(".select-q:checked")).map(cb => cb.value);
      if(ids.length===0) return alert("Nothing selected");
      if(!confirm("Delete selected?")) return;
      await fetch('/api/questions/delete', {
        method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ids})
      });
      loadQuestions();
    }
  </script>
</body>
</html>
