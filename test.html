<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MindMirror Test</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; }
    .progress { position: fixed; top: 0; left: 0; height: 8px; background: #4a90e2; width: 0%; z-index: 999; transition: width 0.3s; }
    .question { padding: 15px; border-bottom: 1px solid #ddd; }
    .options { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 5px; }
    button { margin: 20px; padding: 10px 20px; font-size: 1em; }
    #result { padding: 20px; }
    canvas { max-width: 400px; }
  </style>
</head>
<body>
  <div class="progress" id="progress"></div>
  <form id="testForm">
    <div id="questions"></div>
    <button type="submit">Submit Test</button>
  </form>
  <div id="result" style="display:none;">
    <h2>Evaluation</h2>
    <p id="evalText"></p>
    <canvas id="chart"></canvas>
    <div>
      <button onclick="location.reload()">Retake Test</button>
      <button onclick="location.href='/logout'">Logout</button>
    </div>
  </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const questionData = [
  // put the 130 questions you made in an array
  "I feel confident about my future.",
  "I find it easy to relax.",
  "I am motivated to achieve my goals.",
  "I can adapt to change easily.",
  "I generally have a positive outlook.",
  // add the rest of your 130 here (or even import via server if you wish)
];

while(questionData.length<130){
  questionData.push(`Sample question ${questionData.length+1}`);
}

const questionsDiv = document.getElementById("questions");
questionData.forEach((q,i)=>{
  const div = document.createElement("div");
  div.className="question";
  div.innerHTML=`<strong>${i+1}. ${q}</strong>
  <div class="options">
    <label><input type="radio" name="q${i}" value="Strongly Agree">Strongly Agree</label>
    <label><input type="radio" name="q${i}" value="Agree">Agree</label>
    <label><input type="radio" name="q${i}" value="Neutral">Neutral</label>
    <label><input type="radio" name="q${i}" value="Disagree">Disagree</label>
    <label><input type="radio" name="q${i}" value="Strongly Disagree">Strongly Disagree</label>
  </div>`;
  questionsDiv.appendChild(div);
});

// progress bar
document.addEventListener("input", ()=>{
  const answered = document.querySelectorAll("input:checked").length;
  const percent = (answered/questionData.length)*100;
  document.getElementById("progress").style.width = percent + "%";
});

document.getElementById("testForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const form = new FormData(e.target);
  const answers = {};
  form.forEach((v,k)=>{
    answers[k]=v;
  });
  if(Object.keys(answers).length<1){
    alert("Answer at least one question");
    return;
  }
  const response = await fetch("/test",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({answers})
  });
  const result = await response.json();
  document.getElementById("testForm").style.display="none";
  document.getElementById("result").style.display="block";
  document.getElementById("evalText").innerText=result.evaluation;

  new Chart(document.getElementById("chart"),{
    type:"radar",
    data:{
      labels:["Emotional Stability","Stress Resilience","Social Interaction","Motivation","Self-Discipline","Optimism"],
      datasets:[{
        label:"Profile",
        data:result.scores,
        fill:true,
        backgroundColor:"rgba(74,144,226,0.3)",
        borderColor:"#4a90e2"
      }]
    },
    options:{
      scales:{r:{min:0,max:100}}
    }
  });
});
</script>
</body>
</html>